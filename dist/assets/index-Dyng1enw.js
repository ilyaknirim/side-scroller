(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();let h,v,E,S,f,s,W,D,T,R,O,P,j,F,U,A,G,N,H,q,J,K,X,w,L,g;function le(){h=document.getElementById("menu"),v=document.getElementById("session"),E=document.getElementById("character"),S=document.getElementById("worldset"),f=document.getElementById("game-launcher"),s=document.getElementById("seed-input"),W=document.getElementById("generate-btn"),D=document.getElementById("character-btn"),T=document.getElementById("worldset-btn"),R=document.getElementById("session-text"),O=document.getElementById("regen-btn"),P=document.getElementById("play-btn"),j=document.getElementById("download-btn"),F=document.getElementById("send-btn"),U=document.getElementById("back-btn"),A=document.getElementById("character-text"),G=document.getElementById("regen-character-btn"),N=document.getElementById("download-character-btn"),H=document.getElementById("back-character-btn"),q=document.getElementById("worldset-text"),J=document.getElementById("regen-worldset-btn"),K=document.getElementById("download-worldset-btn"),X=document.getElementById("back-worldset-btn"),w=document.getElementById("launch-msg"),L=document.getElementById("game-root"),g=document.getElementById("stop-game")}function de(){const t=new URLSearchParams(window.location.search).get("seed");t&&(s.value=t)}function ae(){let e;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t;const o=document.getElementById("install-btn");o&&(o.style.display="block",o.addEventListener("click",()=>{o.style.display="none",e.prompt(),e.userChoice.then(r=>{r.outcome==="accepted"&&console.log("User accepted the install prompt"),e=null})}))})}function b(e){let t=e%2147483647;return t<=0&&(t+=2147483646),function(){return t=t*16807%2147483647,(t-1)/2147483646}}function z(e,t={}){const o=b(e||Date.now()),r=["Поток сознания","Хроногнозия","Семантические сети","Метакогниция","Аффективный ландшафт","Перцептуальные сдвиги"],n=["Инверсия восприятия","Туннельное зрение","Хроматическая адаптация","Рабочая память","Разделение внимания","Когнитивная нагрузка","Ментальные вращения","Когнитивные искажения","Эмоциональные барьеры","Локальные временные поля","Проприоцептивный дрифт","Мнемонические якоря"],c=t.theme||r[Math.floor(o()*r.length)],l=t.difficulty||1+Math.floor(o()*5),d=1+Math.floor(o()*3),a=[],i=new Set;for(;a.length<d;){const m=n[Math.floor(o()*n.length)];i.has(m)||(i.add(m),a.push(m))}const u={gravity:.5+o()*1.2*(1+(l-1)*.15),gap:Math.round(80+o()*160/l),speed:2+o()*3*(1+(l-1)*.2),colorSeed:Math.floor(o()*360)};return{seed:e||Date.now(),theme:c,difficulty:l,modifiers:a,level:u}}function Q(e,t,o){const r=["Поток","Эхо","Зазеркалье","Катарсис","Резонанс","Хаос"];return`${r[o%r.length]||r[0]} — ${e}`}function se(e,t){const n=document.createElement("canvas");n.width=240,n.height=80,n.style.borderRadius="6px",n.style.display="block";const c=n.getContext("2d"),l=t&&t.colorSeed?t.colorSeed%360:200;c.fillStyle=`hsl(${l} 60% 8%)`,c.fillRect(0,0,240,80);const d=b(t&&t.seed?t.seed:Date.now());for(let a=0;a<8;a++){const i=a*30+6,u=10+Math.floor(d()*40);c.fillStyle=`hsl(${(l+a*12)%360} 70% 40%)`,c.fillRect(i,80-u-8,240/8-10,u)}return e.appendChild(n),n}function ie(e,t,o){const r=["Сегодня ты —","Ночь шепчет:","Перед тобой —"],n=["исследователь памяти","архитектор сновидений","скиталец мыслей","хранитель якорей"],c=["ищет","переплетает","откладывает","воскрешает"],l=["воспоминания","ассоциации","эмоции","узлы смысла"],d=b(o||Date.now()),a=r[Math.floor(d()*r.length)],i=n[Math.floor(d()*n.length)],u=c[Math.floor(d()*c.length)],m=l[Math.floor(d()*l.length)];return`${a} ${i}, который ${u} ${m}. Тема: ${e}. Модификаторы: ${t.join(", ")}`}function ue(e=Math.random()){const t=["Brave","Wise","Swift","Mighty","Clever","Bold","Gentle","Fierce"],o=["Warrior","Scholar","Explorer","Guardian","Artist","Healer","Hunter","Sage"],r=Math.floor(e*t.length),n=Math.floor(e*1e3%o.length);return`${t[r]}${n}`}function V(e=Math.random()){const t=ue(e),o=["Strength","Intelligence","Agility","Charisma","Wisdom","Luck"],r=o[Math.floor(e*o.length)],n=o[Math.floor(e*100%o.length)];return{id:t,name:t,seed:e,primaryTrait:r,secondaryTrait:n,level:Math.floor(e*10)+1,experience:Math.floor(e*1e3)}}function me(e){return`${e.name} (Level ${e.level}) - ${e.primaryTrait}/${e.secondaryTrait}, ${e.experience} XP`}function Y(e){const t=l=>{let d=Math.sin(l)*1e4;return d-Math.floor(d)},o=["Воин Света","Теневой Странник","Кристаллический Маг","Лесной Дух","Огненный Феникс","Ледяной Страж","Громовой Титан","Ветреный Кочевник"],r=["Кристалл Вечности","Дерево Жизни","Огненный Алтарь","Ледяной Трон","Громовой Молот","Ветреный Кристалл","Земляной Тотем","Водяной Источник"],n=Math.floor(t(e)*o.length),c=Math.floor(t(e+1)*r.length);return{character:o[n],worldObject:r[c],seed:e}}function he(e){return`Персонаж: ${e.character}
Объект мира: ${e.worldObject}`}let B=null,C=null,$=null,I=null;function Z(e){B=e}function _(e){C=e}function ee(e){$=e}function x(e){I=e}function p(){return B}function te(){return C}function ne(){return $}function M(){return I}function fe(){B=null,C=null,$=null,I=null}function oe(){const e=p();if(!e)return;const t=Q(e.theme,e.modifiers,e.seed),o=ie(e.theme,e.modifiers,e.seed);R.textContent=`Название: ${t}

${ge(e)}

История: ${o}`,h.style.display="none",v.classList.remove("hidden")}function re(){const e=te();e&&(A.textContent=me(e),h.style.display="none",E.classList.remove("hidden"))}function ce(){const e=ne();e&&(q.textContent=he(e),h.style.display="none",S.classList.remove("hidden"))}function ge(e){return`Тема: ${e.theme}
Сложность: ${e.difficulty}
Модификаторы: ${e.modifiers.join(", ")}
Seed: ${e.seed}
Уровень: гравитация=${e.level.gravity.toFixed(2)}, зазор=${e.level.gap}, скорость=${e.level.speed.toFixed(2)}`}function k(e,t){const o=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r)}function pe(){const e=s.value?parseInt(s.value):null;x(e);const t=z(e);Z(t),oe()}function ye(){const e=s.value?parseFloat(s.value):Math.random();x(e);const t=V(e);_(t),re()}function we(){const e=s.value?parseFloat(s.value):Math.random();x(e);const t=Y(e);ee(t),ce()}function ve(){const e=z(M());Z(e),oe()}function Ee(){const e=V(M());_(e),re()}function Se(){const e=Y(M());ee(e),ce()}function Le(){const e=p();if(!e)return;f.classList.remove("hidden"),w.textContent=`Запуск сессии: ${Q(e.theme,e.modifiers,e.seed)}`;const t=document.createElement("div");t.style.margin="10px 0",se(t,e.level),w.appendChild(t),L.innerHTML="<p>Игра загружается... (демо режим)</p>",g.classList.remove("hidden")}function be(){f.classList.add("hidden"),L.innerHTML="",g.classList.add("hidden")}function Be(){const e=p();if(!e)return;const t=xe(e);k("session.txt",t)}function Ce(){const e=te();if(!e)return;const t=Me(e);k("character.txt",t)}function $e(){const e=ne();if(!e)return;const t=ke(e);k("worldset.txt",t)}function Ie(){const e=p();if(e)if(window.Telegram&&window.Telegram.WebApp){const t={session:e,timestamp:Date.now()};window.Telegram.WebApp.sendData(JSON.stringify(t))}else{const t=JSON.stringify(e,null,2);navigator.clipboard.writeText(t).then(()=>{alert("Данные сессии скопированы в буфер обмена")})}}function y(){v.classList.add("hidden"),E.classList.add("hidden"),S.classList.add("hidden"),f.classList.add("hidden"),h.style.display="block",fe()}function xe(e){return`Тема: ${e.theme}
Сложность: ${e.difficulty}
Модификаторы: ${e.modifiers.join(", ")}
Seed: ${e.seed}
Уровень: гравитация=${e.level.gravity.toFixed(2)}, зазор=${e.level.gap}, скорость=${e.level.speed.toFixed(2)}`}function Me(e){const{formatCharacterDescription:t}=require("../systems/character_generator.js");return t(e)}function ke(e){const{formatWorldSetDescription:t}=require("../systems/integration.js");return t(e)}function We(){W.addEventListener("click",pe),D.addEventListener("click",ye),T.addEventListener("click",we),O.addEventListener("click",ve),P.addEventListener("click",Le),j.addEventListener("click",Be),F.addEventListener("click",Ie),U.addEventListener("click",y),G.addEventListener("click",Ee),N.addEventListener("click",Ce),H.addEventListener("click",y),J.addEventListener("click",Se),K.addEventListener("click",$e),X.addEventListener("click",y),g.addEventListener("click",be)}function De(){le(),de(),ae(),We()}document.addEventListener("DOMContentLoaded",De);
