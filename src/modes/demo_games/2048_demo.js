export function runDemo(container,level={}){const el=document.createElement('div');el.style.width='360px';el.style.padding='8px';el.style.background='rgba(255,255,255,0.02)';el.style.borderRadius='8px';container.appendChild(el);const board=Array.from({length:4},()=>Array(4).fill(0));function addRandom(){const empties=[];for(let r=0;r<4;r++)for(let c=0;c<4;c++)if(board[r][c]===0)empties.push([r,c]);if(!empties.length)return;const [r,c]=empties[Math.floor(Math.random()*empties.length)];board[r][c]=Math.random()<0.9?2:4;}function render(){el.innerHTML='';const grid=document.createElement('div');grid.style.display='grid';grid.style.gridTemplateColumns='repeat(4,1fr)';grid.style.gap='6px';for(let r=0;r<4;r++)for(let c=0;c<4;c++){const cell=document.createElement('div');cell.style.padding='18px';cell.style.borderRadius='6px';cell.style.textAlign='center';cell.style.fontWeight='700';cell.textContent=board[r][c]||'';cell.style.background=board[r][c]? 'rgba(255,255,255,0.08)':'rgba(255,255,255,0.02)';grid.appendChild(cell);}el.appendChild(grid);}function swipe(dir){function slide(row){const arr=row.filter(x=>x);for(let i=0;i<arr.length-1;i++){if(arr[i]===arr[i+1]){arr[i]*=2;arr.splice(i+1,1);}}while(arr.length<4)arr.push(0);return arr;}let moved=false;if(dir==='left'){for(let r=0;r<4;r++){const old=board[r].slice();board[r]=slide(board[r]);if(old.join()!=board[r].join())moved=true;}}if(dir==='right'){for(let r=0;r<4;r++){const old=board[r].slice();board[r]=slide(board[r].slice().reverse()).reverse();if(old.join()!=board[r].join())moved=true;}}if(dir==='up'){for(let c=0;c<4;c++){const col=[];for(let r=0;r<4;r++)col.push(board[r][c]);const old=col.join(',');const res=slide(col);for(let r=0;r<4;r++)board[r][c]=res[r];if(old!=col.join(','))moved=true;}}if(dir==='down'){for(let c=0;c<4;c++){const col=[];for(let r=0;r<4;r++)col.push(board[r][c]);const old=col.join(',');const res=slide(col.reverse()).reverse();for(let r=0;r<4;r++)board[r][c]=res[r];if(old!=col.join(','))moved=true;}}if(moved)addRandom();render();}addRandom();addRandom();render();function onKey(e){const k=e.key||e.code;if(k.includes('ArrowLeft')||k==='a')swipe('left');if(k.includes('ArrowRight')||k==='d')swipe('right');if(k.includes('ArrowUp')||k==='w')swipe('up');if(k.includes('ArrowDown')||k==='s')swipe('down');}window.addEventListener('keydown',onKey);return{stop(){window.removeEventListener('keydown',onKey);if(container.contains(el))container.removeChild(el);}};}