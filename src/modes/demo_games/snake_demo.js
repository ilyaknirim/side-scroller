import { GAME_WIDTH, GAME_HEIGHT } from '../../utils/constants.js';

export function runDemo(container,level={}){const canvas=document.createElement('canvas');canvas.width=GAME_WIDTH;canvas.height=GAME_HEIGHT;container.appendChild(canvas);const ctx=canvas.getContext('2d');const cell=16;let dir='right';let snake=[{x:5,y:5}];let food={x:10,y:10};let running=true;let speed=Math.max(50,180-(level.difficulty||1)*20);function placeFood(){food.x=Math.floor(Math.random()*(canvas.width/cell));food.y=Math.floor(Math.random()*(canvas.height/cell));}function update(){const modifiers=(level && level.modifiers)|| [];if(modifiers.includes('Телепорт-хаос')&& Math.random()<0.01){snake[0].x=Math.floor(Math.random()*(canvas.width/cell));snake[0].y=Math.floor(Math.random()*(canvas.height/cell));}const head={x:snake[0].x,y:snake[0].y};if(dir==='left')head.x--;if(dir==='right')head.x++;if(dir==='up')head.y--;if(dir==='down')head.y++;const w=canvas.width/cell,h=canvas.height/cell;head.x=(head.x+w)% w;head.y=(head.y+h)% h;snake.unshift(head);if(head.x===food.x && head.y===food.y){placeFood();}else{snake.pop();}}function draw(){ctx.fillStyle='#071229';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#0f0';snake.forEach(s=>ctx.fillRect(s.x*cell,s.y*cell,cell-2,cell-2));ctx.fillStyle='#f00';ctx.fillRect(food.x*cell,food.y*cell,cell-2,cell-2);}function loop(){if(!running)return;update();draw();setTimeout(loop,speed);}function onKey(e){const k=e.key || e.code;if(k.includes('ArrowLeft')|| k==='a')dir='left';if(k.includes('ArrowRight')|| k==='d')dir='right';if(k.includes('ArrowUp')|| k==='w')dir='up';if(k.includes('ArrowDown')|| k==='s')dir='down';}window.addEventListener('keydown',onKey);placeFood();loop();return{stop(){running=false;window.removeEventListener('keydown',onKey);if(container.contains(canvas))container.removeChild(canvas);}};}