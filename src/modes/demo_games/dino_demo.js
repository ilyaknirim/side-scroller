import { GAME_WIDTH, GAME_HEIGHT } from '../../utils/constants.js';

export function runDemo(container,level={}){const canvas=document.createElement('canvas');canvas.width=GAME_WIDTH;canvas.height=GAME_HEIGHT;container.appendChild(canvas);const ctx=canvas.getContext('2d');let dino={x:50,y:canvas.height-40,vy:0,onGround:true};const gravity=0.6;let obstacles=[];let speed=level.speed || 4;let frames=0;let running=true;function spawn(){if(Math.random()<0.02)obstacles.push({x:canvas.width,w:20,h:20});}function update(){frames++;dino.vy+=gravity;dino.y+=dino.vy;if(dino.y>=canvas.height-40){dino.y=canvas.height-40;dino.vy=0;dino.onGround=true;}for(const o of obstacles)o.x-=speed;obstacles=obstacles.filter(o=>o.x+o.w>-10);spawn();for(const o of obstacles){if(o.x<dino.x+30 && o.x+o.w>dino.x && dino.y+20>o.x*0-100){}}}function draw(){ctx.fillStyle='#071229';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle='#eee';ctx.fillRect(dino.x,dino.y,30,30);ctx.fillStyle='#a33';for(const o of obstacles)ctx.fillRect(o.x,canvas.height-30,o.w,o.h);ctx.fillStyle='#555';ctx.fillRect(0,canvas.height-10,canvas.width,10);}function loop(){if(!running)return;update();draw();requestAnimationFrame(loop);}function jump(){if(dino.onGround){dino.vy=-11;dino.onGround=false;}}function onKey(e){if(e.code==='Space' || e.key==='w')jump();}window.addEventListener('keydown',onKey);canvas.addEventListener('pointerdown',jump);loop();return{stop(){running=false;window.removeEventListener('keydown',onKey);canvas.removeEventListener('pointerdown',jump);if(container.contains(canvas))container.removeChild(canvas);}};}