import{GAME_WIDTH,GAME_HEIGHT}from './constants.js';let tg=window.Telegram.WebApp;tg.expand();const menuContainer=document.getElementById('menu-container');const gameContainer=document.getElementById('game-container');const backButton=document.getElementById('back-button');const canvas=document.getElementById('game-canvas');const ctx=canvas.getContext('2d');const scoreElement=document.getElementById('score');const bestScoreElement=document.getElementById('best-score');const gameOverlay=document.getElementById('game-overlay');const overlayTitle=document.getElementById('overlay-title');const overlayMessage=document.getElementById('overlay-message');const startButton=document.getElementById('start-button');canvas.width=GAME_WIDTH;canvas.height=GAME_HEIGHT;let currentGame=null;export let gameState='start';export let score=0;let bestScore={};let animationId=null;export function updateScore(newScore){score=newScore;scoreElement.textContent=score;}export{ctx,scoreElement,canvas};function loadBestScores(){const savedScores=localStorage.getItem('gamesBestScores');if(savedScores){bestScore=JSON.parse(savedScores);}else{bestScore={flappy:0,dinoGame:0,doodle:0,snake:0,breakout:0,'2048':0};}if(currentGame==='dino'){bestScoreElement.textContent=bestScore.dinoGame || 0;}else{bestScoreElement.textContent=bestScore[currentGame] || 0;}}function saveBestScores(){localStorage.setItem('gamesBestScores',JSON.stringify(bestScore));}function gameOver(){gameState='gameover';let currentScoreValue=score;if(currentGame==='breakout'){currentScoreValue=getCurrentScore();}else if(currentGame==='dino'){currentScoreValue=getCurrentScoreDino();}if(currentGame==='dino'){if(currentScoreValue>bestScore.dinoGame){bestScore.dinoGame=currentScoreValue;saveBestScores();bestScoreElement.textContent=bestScore.dinoGame;}}else{if(currentScoreValue>bestScore[currentGame]){bestScore[currentGame]=currentScoreValue;saveBestScores();bestScoreElement.textContent=bestScore[currentGame];}}overlayTitle.textContent='Игра окончена!';overlayMessage.textContent=`Ваш счёт:${currentScoreValue}`;startButton.textContent='Играть снова';gameOverlay.style.display='flex';}document.querySelectorAll('.game-card').forEach(card=>{card.addEventListener('click',function(){const gameType=this.getAttribute('data-game');startGame(gameType);});});backButton.addEventListener('click',()=>{gameContainer.style.display='none';menuContainer.style.display='flex';currentGame=null;if(animationId){cancelAnimationFrame(animationId);animationId=null;}});function startGame(gameType){currentGame=gameType;score=0;scoreElement.textContent=score;loadBestScores();menuContainer.style.display='none';gameContainer.style.display='block';switch(gameType){case 'flappy':overlayTitle.textContent='Flappy Bird';overlayMessage.textContent='Нажмите,чтобы начать';setGameOverFlappy(gameOver);initFlappyBird();break;case 'dino':overlayTitle.textContent='Dino Run';overlayMessage.textContent='Нажмите,чтобы начать';setGameOverDino(gameOver);initDinoRun();break;case 'doodle':overlayTitle.textContent='Doodle Jump';overlayMessage.textContent='Нажмите,чтобы начать';setGameOverDoodle(gameOver);setCurrentGameDoodle('doodle');initDoodleJump(canvas);break;case 'snake':overlayTitle.textContent='Snake';overlayMessage.textContent='Нажмите,чтобы начать';setGameOverSnake(gameOver);initSnake();break;case 'breakout':overlayTitle.textContent='Breakout';overlayMessage.textContent='Нажмите,чтобы начать';setGameOverBreakout(gameOver);setCurrentGameBreakout('breakout');initBreakout(canvas);break;case '2048':overlayTitle.textContent='2048';overlayMessage.textContent='Сдвиньте плитки,чтобы начать';setGameOver2048(gameOver);setCurrentGame2048('2048');init2048(canvas);break;}gameOverlay.style.display='flex';startButton.textContent='Начать игру';gameLoop();}startButton.addEventListener('click',()=>{gameState='playing';gameOverlay.style.display='none';switch(currentGame){case 'flappy':resetFlappyBird();break;case 'dino':resetDinoRun();break;case 'doodle':resetDoodleJump();break;case 'snake':resetSnake();break;case 'breakout':resetBreakout();break;case '2048':reset2048();break;}});document.addEventListener('keydown',(e)=>{if(gameState !=='playing')return;switch(currentGame){case 'flappy':if(e.code==='Space'){bird.flap();}break;case 'dino':if(e.code==='Space' || e.code==='ArrowUp'){dino.jump();}break;case 'snake':if(e.code==='ArrowUp' && snake.direction !=='down'){snake.nextDirection='up';}else if(e.code==='ArrowDown' && snake.direction !=='up'){snake.nextDirection='down';}else if(e.code==='ArrowLeft' && snake.direction !=='right'){snake.nextDirection='left';}else if(e.code==='ArrowRight' && snake.direction !=='left'){snake.nextDirection='right';}break;case '2048':if(e.code==='ArrowUp'){move2048('up');}else if(e.code==='ArrowDown'){move2048('down');}else if(e.code==='ArrowLeft'){move2048('left');}else if(e.code==='ArrowRight'){move2048('right');}break;}});canvas.addEventListener('click',()=>{if(gameState !=='playing')return;switch(currentGame){case 'flappy':bird.flap();break;case 'dino':dino.jump();break;case 'doodle':doodle.jump();break;}});canvas.addEventListener('touchstart',(e)=>{e.preventDefault();if(gameState !=='playing')return;switch(currentGame){case 'flappy':bird.flap();break;case 'dino':dino.jump();break;case 'doodle':doodle.jump();break;}});let touchStartX=0;let touchStartY=0;canvas.addEventListener('touchstart',(e)=>{if(currentGame !=='2048' || gameState !=='playing')return;touchStartX=e.touches[0].clientX;touchStartY=e.touches[0].clientY;});canvas.addEventListener('touchend',(e)=>{if(currentGame !=='2048' || gameState !=='playing')return;const touchEndX=e.changedTouches[0].clientX;const touchEndY=e.changedTouches[0].clientY;const dx=touchEndX-touchStartX;const dy=touchEndY-touchStartY;if(Math.abs(dx)>Math.abs(dy)){if(dx>0){move2048('right');}else{move2048('left');}}else{if(dy>0){move2048('down');}else{move2048('up');}}});function gameLoop(){ctx.clearRect(0,0,GAME_WIDTH,GAME_HEIGHT);switch(currentGame){case 'flappy':updateFlappyBird();drawFlappyBird();break;case 'dino':updateDinoRun();drawDinoRun();break;case 'doodle':updateDoodleJump();drawDoodleJump();break;case 'snake':updateSnake();drawSnake();break;case 'breakout':updateBreakout();drawBreakout();break;case '2048':draw2048();break;}animationId=requestAnimationFrame(gameLoop);}// Импорты игр временно отключены, так как они находятся в другой директории
// Будем использовать демо-версии из src/modes/demo_games/